<!-- FORM GROUP -->
<div
  class="form-group risca-form-group"
  [ngClass]="cssConfig.customForm | riscaCssHandler: C_C.CSS_TYPE_CLASS"
  [ngStyle]="cssConfig.customForm | riscaCssHandler: C_C.CSS_TYPE_STYLE"
>
  <!-- LABEL -->
  <risca-input-label
    [cssConfig]="cssConfig"
    [dataConfig]="dataConfig"
    [idFormControl]="idFC"
    [formGroup]="formGroup"
    [idDOM]="idDOM"
    [disableRequiredCheck]="disableRequired"
  ></risca-input-label>

  <!-- CONTENITORE PER LA INPUT -->
  <div class="row r-m--0 r-p--0">
    <!-- COLONNA LABEL DI SINISTRA -->
    <div *riscaMaintain="labelLeftTmpl"
      class="col-auto r-m--0 r-mr--15 r-p--0"
      [ngClass]="cssConfig.labelColLeft | riscaCssHandler: C_C.CSS_TYPE_CLASS"
      [ngStyle]="cssConfig.labelColLeft | riscaCssHandler: C_C.CSS_TYPE_STYLE"
    >
      <risca-input-label
        [cssConfig]="cssConfig"
        [dataConfig]="dataConfig"
        [idFormControl]="idFC"
        [formGroup]="formGroup"
        [idDOM]="idDOM"
        [disableRequiredCheck]="disableRequired"
        [position]="labelLeft"
      ></risca-input-label>
    </div>

    <!-- COLONNA DELLA INPUT -->
    <div class="col r-m--0 r-p--0">
      <ng-container *ngTemplateOutlet="riscaTypehaedTmpl"></ng-container>
      <ng-container *ngTemplateOutlet="riscaTypehaedNumberTmpl"></ng-container>
    </div>

    <!-- COLONNA LABEL DI DESTRA -->
    <div *riscaMaintain="labelRightTmpl"
      class="col-auto r-m--0 r-ml--15 r-p--0"
      [ngClass]="cssConfig.labelColRight | riscaCssHandler: C_C.CSS_TYPE_CLASS"
      [ngStyle]="cssConfig.labelColRight | riscaCssHandler: C_C.CSS_TYPE_STYLE"
    >
      <risca-input-label
        [cssConfig]="cssConfig"
        [dataConfig]="dataConfig"
        [idFormControl]="idFC"
        [formGroup]="formGroup"
        [idDOM]="idDOM"
        [disableRequiredCheck]="disableRequired"
        [position]="labelRight"
      ></risca-input-label>
    </div>
  </div>

  <!-- TEMPLATE PER IL SUGGERIMENTO TYPEAHEAD -->
  <ng-template #typeahedTemplate let-result="result" let-input="term">
    <ngb-highlight
      [result]="result | riscaTypeaheadMap:typeaheadMap"
      [term]="input"
    ></ngb-highlight>
  </ng-template>

  <!-- FORM CONTROL - GESTIONE ERRORI -->
  <risca-form-control-error
    [cssConfig]="cssConfig"
    [idFormControl]="idFC"
    [formGroup]="formGroup"
    [errMapFormControl]="mappaErroriFC"
    [formSubmitted]="formSubmitted"
  ></risca-form-control-error>
  <!-- FORM GROUP - GESTIONE ERRORI -->
  <risca-form-group-error
    [cssConfig]="cssConfig"
    [formGroup]="formGroup"
    [errMapFormGroup]="mappaErroriFG"
    [formSubmitted]="formSubmitted"
  ></risca-form-group-error>
</div>

<ng-template #riscaTypehaedTmpl>
  <!-- INPUT - TEXT STANDARD SENZA TEMPLATE PER DATA VALIDITA -->
  <ng-container *riscaMaintain="!dataConfig.onlyNumber && !dataConfig.dataValidita">
    <input #inputTypeahead
      [id]="idDOM"
      [name]="idFC"
      [(ngModel)]="_value"
      [disabled]="disabled"
      [placeholder]="dataConfig?.placeholder || ''"
      type="text"
      class="form-control risca-input-border"
      maxlength="{{ dataConfig.maxLength }}"
      [ngClass]="[
        cssConfig.customInput !== undefined ? cssConfig.customInput : '',
        (cssConfig.showErrorFC &&
          formControl.invalid &&
          (formSubmitted || formControl.dirty || formControl.touched)) ||
        (cssConfig.showErrorFG &&
          formGroup.invalid &&
          formErrors &&
          (formSubmitted || formGroup.dirty || formGroup.touched))
          ? 'risca-input-border-error'
          : '',
        conditionalClass
      ]"
      (blur)="autoCompleteOnBlur()"
      [ngbTypeahead]="typeaheadSearch"
      [inputFormatter]="typeaheadMap"
      [resultFormatter]="typeaheadMap"
      [editable]="editable"
      (selectItem)="onSelectItem($event)"
      NoTab
    />
  </ng-container>
  <!-- INPUT - TEXT STANDARD CON TEMPLATE PER DATA VALIDITA -->
  <ng-container *riscaMaintain="!dataConfig.onlyNumber && dataConfig.dataValidita">
    <input #inputTypeahead
      [id]="idDOM"
      [name]="idFC"
      [(ngModel)]="_value"
      [disabled]="disabled"
      [placeholder]="dataConfig?.placeholder || ''"
      type="text"
      class="form-control risca-input-border"
      maxlength="{{ dataConfig.maxLength }}"
      [ngClass]="[
        cssConfig.customInput !== undefined ? cssConfig.customInput : '',
        (cssConfig.showErrorFC &&
          formControl.invalid &&
          (formSubmitted || formControl.dirty || formControl.touched)) ||
        (cssConfig.showErrorFG &&
          formGroup.invalid &&
          formErrors &&
          (formSubmitted || formGroup.dirty || formGroup.touched))
          ? 'risca-input-border-error'
          : '',
        conditionalClass
      ]"
      (blur)="autoCompleteOnBlur()"
      [ngbTypeahead]="typeaheadSearch"
      [inputFormatter]="typeaheadMap"
      [resultTemplate]="resultTmplDV"
      [editable]="editable"
      (selectItem)="onSelectItem($event)"
      NoTab
    />
  </ng-container>
</ng-template>

<ng-template #riscaTypehaedNumberTmpl>
  <!-- INPUT - TEXT, MA CON SOLO NUMERI AMMESSI E SENZA TEMPLATE PER DATA VALIDITA -->
  <ng-container *riscaMaintain="dataConfig.onlyNumber && !dataConfig.dataValidita">
    <input #inputTypeahead
      [id]="idDOM"
      [name]="idFC"
      [(ngModel)]="_value"
      [disabled]="disabled"
      [placeholder]="dataConfig?.placeholder || ''"
      type="text"
      class="form-control risca-input-border"
      [ngClass]="[
        cssConfig.customInput !== undefined ? cssConfig.customInput : '',
        (cssConfig.showErrorFC &&
          formControl.invalid &&
          (formSubmitted || formControl.dirty || formControl.touched)) ||
        (cssConfig.showErrorFG &&
          formGroup.invalid &&
          formErrors &&
          (formSubmitted || formGroup.dirty || formGroup.touched))
          ? 'risca-input-border-error'
          : '',
        conditionalClass
      ]"
      maxlength="{{ dataConfig.maxLength }}"
      (blur)="autoCompleteOnBlur()"
      [ngbTypeahead]="typeaheadSearch"
      [inputFormatter]="typeaheadMap"
      [resultFormatter]="typeaheadMap"
      [editable]="editable"
      (selectItem)="onSelectItem($event)"
      NumbersOnly
      NoTab
      [allowDecimals]="dataConfig.useDecimal"
      [allowSign]="dataConfig.useSign"
    />
  </ng-container>
  <!-- INPUT - TEXT, MA CON SOLO NUMERI AMMESSI E CON TEMPLATE PER DATA VALIDITA -->
  <ng-container *riscaMaintain="dataConfig.onlyNumber && dataConfig.dataValidita">
    <input #inputTypeahead
      [id]="idDOM"
      [name]="idFC"
      [(ngModel)]="_value"
      [disabled]="disabled"
      [placeholder]="dataConfig?.placeholder || ''"
      type="text"
      class="form-control risca-input-border"
      [ngClass]="[
        cssConfig.customInput !== undefined ? cssConfig.customInput : '',
        (cssConfig.showErrorFC &&
          formControl.invalid &&
          (formSubmitted || formControl.dirty || formControl.touched)) ||
        (cssConfig.showErrorFG &&
          formGroup.invalid &&
          formErrors &&
          (formSubmitted || formGroup.dirty || formGroup.touched))
          ? 'risca-input-border-error'
          : '',
        conditionalClass
      ]"
      maxlength="{{ dataConfig.maxLength }}"
      (blur)="autoCompleteOnBlur()"
      [ngbTypeahead]="typeaheadSearch"
      [inputFormatter]="typeaheadMap"
      [resultTemplate]="resultTmplDV"
      [editable]="editable"
      (selectItem)="onSelectItem($event)"
      NumbersOnly
      NoTab
      [allowDecimals]="dataConfig.useDecimal"
      [allowSign]="dataConfig.useSign"
    />
  </ng-container>
</ng-template>

<ng-template #resultTmplDV let-element="result" let-t="term">
  <div [ngClass]="element | riscaTypeaheadDataValidita">
    <ngb-highlight
      [result]="typeaheadMap | riscaExecute:element"
      [term]="t"
    ></ngb-highlight>
  </div>
</ng-template>
